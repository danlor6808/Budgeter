@model Budgeter.Models.HouseholdCreateJoinMV
@using Microsoft.AspNet.Identity;

@{
    if (Model.user.HouseholdId != null)
    {
        ViewBag.Title = "Household: " + Model.household.Name;
    }
    else
    {
        ViewBag.Title = "Household: Homeless";
    }

}

@if (Model.user.HouseholdId == null)
{
        <div class="col-md-6 col-md-offset-3">
            <div class="panel panel-default">
                <div class="panel-heading">
                    Alert
                </div>
            <div class="panel-body">
                <p>
                    You are currently homeless. 
                    Please create a new household
                    @if (Model.user.PreviousHouseholdId != null)
                    {
                        <text>or press the "Previous Household" button to rejoin the last household you were a member of.</text>
                    }
                </p>
                    <a href="@Url.Action("Create", "Household")" class="btn btn-primary pull-right" data-target="#displayModal" data-toggle="modal">Create</a>

                @if (Model.user.PreviousHouseholdId != null)
                {
                    using (Html.BeginForm("RejoinHousehold", "Household", FormMethod.Post))
                    {
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn btn-default pull-right">Previous Household</button>
                    }
                }
                </div>
            </div>
        </div>
}
else
{
    <div class="col-md-8">
        <div class="panel panel-default">
            <div class="panel-heading">
                Household Details
            </div>
            <div class="panel-body">
                <dl class="dl-horizontal">
                    <dt>
                        @Html.DisplayNameFor(model => model.household.Name)
                    </dt>

                    <dd>
                        @Html.DisplayFor(model => model.household.Name)
                    </dd>
                    <dt>
                        @Html.DisplayNameFor(model => model.household.Created)
                    </dt>

                    <dd>
                        @Html.DisplayFor(model => model.household.Created)
                    </dd>

                    @*<dt>
                        @Html.DisplayNameFor(model => model.household.Updated)
                    </dt>

                    <dd>
                        @Html.DisplayFor(model => model.household.Updated)
                    </dd>*@
                    <dt>
                        Current Members
                    </dt>

                    <dd>
                        @foreach (var user in Model.household.Users)
                        {
                            @user.FirstName<text>&nbsp</text>@user.LastName
                            <br />
                        }
                    </dd>
                </dl>
                @if (Model.user.HouseholdId != null)
                {
                    <a href="@Url.Action("Leavehousehold", "Household")" class="btn btn-primary pull-right" data-target="#displayModal" data-toggle="modal">Leave Household</a>
                }
                else if (Model.user.PreviousHouseholdId != null)
                {
                    using (Html.BeginForm("RejoinHousehold", "Household", FormMethod.Post))
                    {
                        @Html.AntiForgeryToken()
                        <button type="submit" class="btn btn-primary pull-right">Join Previous Household</button>
                    }
                }
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="panel panel-default">
            <div class="panel-heading">
                Pending Member Invitations
            </div>
                <ul class="list-group">
                    @if (ViewBag.Pending != null && ViewBag.Pending.Count > 0)
                {
                    foreach (var invitation in ViewBag.Pending)
                    {
                            <li class="list-group-item">@invitation.Email</li>
                        }
                    }
                    else
                    {
                        <li class="list-group-item">None</li>
                    }
                </ul>
            </div>
    </div>
    <div class="col-md-4">
        <div class="panel panel-default">
            <div class="panel-heading">
                Send Invite
            </div>
            <div class="panel-body">
                @using (Html.BeginForm())
                {
                    @Html.AntiForgeryToken()
                    <span class="text-danger">@TempData["Error"]</span>
                    <span class="text-success">@TempData["Success"]</span>
                        <input type="hidden" name="id" value="@Model.household.id" />
                        <input type="email" class="form-control col-md-8" name="email" style="margin-bottom: 10px" placeholder="example@email.com" required />
                            <button type="submit" class="btn btn-primary pull-right col-md-4">Send</button>
                }
            </div>
        </div>
    </div>
}

<div class="modal fade" id="displayModal" tabindex="-1" role="dialog" aria-labelledby="displayModalLabel" aria-hidden="true" style="display: none;">
    <div class="modal-dialog">
        <div class="modal-content">
        </div>
    </div>
</div>


@section icon
{
    <i class="fa fa-home"></i>
}
